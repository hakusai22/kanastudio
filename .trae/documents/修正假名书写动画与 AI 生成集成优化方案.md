## 问题定位
- 根因：`kanaStrokes` 仅包含少量假名（主要是元音），而页面点击涵盖清音/浊音/拗音与片假名，大量字符没有笔画数据，`KanaWriter` 回退为字体文本，因此“写出来的结果”不正确。
- 复合假名（如“きゃ”）和带浊音（如“が/ガ”）目前未作分解与合成处理，笔画与位置均不准确。

## 改进思路
1. 增强笔画数据与组合逻辑：
- 新增分解函数，将输入拆分为多个字符，并处理浊音/半浊音（映射为基字+゛/゜叠加）、拗音（基字+小や/ゆ/よ）。
- 为゛/゜提供独立笔画（两点与圆点路径），并按基字相对位置叠加。
- 缺失笔画时回退到统一的“描边揭示”效果，而非静态填充文本，使体验一致。

2. `KanaWriter` 渲染管线重构：
- 支持多字符：逐字符布局（水平并排），每字符独立笔画动画；对小假名按比例缩放与右下偏移。
- 动画时间随路径长度自动计算，避免过快/过慢。
- 统一深色样式：网格与描边颜色改为深色主题，提升观感。

3. 补充核心笔画数据（首批）：
- 平假名：あいうえお、かさたなはまやらわをん、小ゃゅょ、及对应的浊音/半浊音叠加。
- 片假名：アイウエオ、カサタナハマヤラワヲン、小ャュョ、及对应浊音/半浊音叠加。
- 后续逐步完善其余字符，保证首屏和常见点击均正确绘制。

4. 验证与优化：
- 在首页逐行抽样点击验证（清音/浊音/拗音/片假名）。
- 确认语音播放与动画重播逻辑正常（避免并发调用造成打断）。

## 具体修改点
- `src/lib/kanaStrokes.ts`：
  - 扩充笔画数据，并新增゛/゜及小假名路径；导出分解辅助数据映射。
- `src/components/KanaWriter.tsx`：
  - 引入分解函数，按字符数组渲染；实现叠加与缩放定位；
  - 动画时间按笔画长度计算；
  - 深色网格和描边色；并发语音调用节流。

## 与 AI 生成的协同
- 已有 `/api/deepseek` 接口；按钮“AI 生成”保留。
- 生成内容与书写动画并排展示，无相互阻塞。

## 交付与测试
- 完成上述改动后，本地运行并在“清音/浊音/拗音/片假名”各类字符抽样点击验证；确保笔画顺序合理、位置正确。
- 如需更高拟真度，可后续切换到开源“KanjiVG/KanaVG”类数据源。

请确认以上方案，我将开始实现并提交修改。